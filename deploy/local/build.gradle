/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */
def group="local"

task clean_all(type: Delete, group: group, description: "Deletes copied resources") {
    dependsOn 'web:clean'
    dependsOn 'upload:clean'
}

task copy_all(group: group, description: "Copies all resourses") {
    dependsOn('web:copy')
    dependsOn('us:copy')
}

task deploy_all(group: group, description: "Redeploys docker") {
    doLast {
    exec {
        commandLine 'docker-compose', 'stop'
    }
    exec {
        commandLine 'docker-compose', 'rm', '-f'
    }
    exec {
        commandLine 'docker-compose', 'build'
    }
    exec {
        commandLine 'docker-compose', 'up', '-d'
    }
    }
    mustRunAfter copy_all
}

task build_deploy_all(group: group, description: "Builds souce and deploys services to docker") {
    dependsOn('copy_all')
    dependsOn('deploy_all')
}

task upload_deploy(group: group, description: "Deploys upload service") {
    doLast {
    exec {
        commandLine 'docker-compose', 'stop', 'uploadService'
    }
    exec {
        commandLine 'docker-compose', 'rm', '-f'
    }
    exec {
        commandLine 'docker-compose', 'build', 'uploadService' 
    }
    exec {
        commandLine 'docker-compose', 'up', '-d'
    }
    }
    mustRunAfter('upload:copy')
}

