/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */
def group="local"

// def spFile = rootProject.file("secret.properties");
// def secrets = new Properties()
// secrets.load(new FileInputStream(spFile))
// secrets["PASS"]

task info(group: group, description: "shows parameters info") {
    println 'EAR_APP_VERSION=' + EAR_APP_VERSION
    println 'SERVICE_VERSION=' + SERVICE_VERSION
}

task clean_all(type: Delete, group: group, description: "Deletes copied resources") {
    dependsOn 'web:clean'
    dependsOn 'upload:clean'
    dependsOn 'status:clean'
    dependsOn 'manager:clean'
    dependsOn 'audio.prepare:clean'
    dependsOn 'diarization:clean'
    dependsOn 'transcription:clean'
    dependsOn 'result.make:clean'
}

task copy_all(group: group, description: "Copies all resourses") {
    dependsOn('web:copy')
    dependsOn('upload:copy')
    dependsOn('status:copy')
    dependsOn('manager:copy')
    dependsOn('audio.prepare:copy')
    dependsOn('diarization:copy')
    dependsOn('transcription:copy')
    dependsOn('result.make:copy')
}

task deploy_all(group: group, description: "Redeploys docker") {
    doLast {
    exec {
        commandLine 'docker-compose', 'stop'
    }
    exec {
        commandLine 'docker-compose', 'rm', '-f'
    }
    exec {
        commandLine 'docker-compose', 'build'
    }
    exec {
        commandLine 'docker-compose', 'up', '-d'
    }
    }
    mustRunAfter copy_all
}

task build_deploy_all(group: group, description: "Builds souce and deploys services to docker") {
    dependsOn('copy_all')
    dependsOn('deploy_all')
}
